# 📋 S-Delivery v3.0 마스터 개발 계획 & 초원자 로드맵

## 1. 프로젝트 개요

**버전**: v3.0 (고객 경험 & 스마트 운영 업그레이드)

**목표**: 타겟 기능 업그레이드를 통해 구체적인 비즈니스 지표(매출, 재방문율, 효율성)를 증대시킵니다.

### 핵심 기능

1. **원클릭 재주문 (One-Click Reorder)**: 단골 고객의 주문 장벽 최소화.
2. **장바구니 업셀링 (Cart Upsell)**: 객단가(AOV) 상승 유도.
3. **스마트 관리자 제어 (Smart Admin Controls)**: 실시간 매장 상태 관리 (품절/일시정지).
4. **고급 일간 리포트 (Advanced Daily Reports)**: 실질적인 비즈니스 인사이트 제공.
5. **간편 추천 엔진 (Simple Recommendations)**: 데이터 기반 메뉴 추천.

---

## 2. 기능 상세 명세 (Feature Specifications)

### 💎 FR-V3-001: 원클릭 재주문

**사용자 스토리**: 사용자가 '주문 내역'에서 "재주문" 버튼을 클릭하면, 당시 주문했던 상품들이 그대로 장바구니에 담깁니다.

**로직**:
1. 모든 상품의 현재 유효성(메뉴 존재 여부, `isSoldOut` 상태)을 검사합니다.
2. 유효하다면 기존 장바구니를 비우고 해당 상품들을 담은 후 주문서로 이동합니다.
3. 일부 상품이 유효하지 않다면(품절 등), 경고 메시지를 띄우고 주문 가능한 상품만 담습니다.

**파일 위치**:
- `src/pages/OrderDetailPage.tsx` - 재주문 버튼 추가
- `src/hooks/useReorder.ts` - 재주문 로직 훅 (신규 생성)
- `src/services/orderService.ts` - 주문 데이터 조회

---

### 💰 FR-V3-002: 장바구니 업셀링 시스템

**사용자 스토리**: 장바구니에 상품이 담겨 있을 때, 하단(또는 서랍)에 "이런 메뉴는 어떠세요?" 추천이 노출됩니다.

**로직**:
1. **트리거**: 장바구니 상품 개수 >= 1
2. **규칙**: 
   - 장바구니에 '메인' 카테고리가 있다면 → '사이드' 또는 '음료' 카테고리 중 장바구니에 없는 상품을 무작위 추천
   - 장바구니에 '사이드'만 있다면 → '메인' 또는 '음료' 추천
3. **UI**: 장바구니 하단에 가로 스크롤 또는 리스트 형태로 노출

**파일 위치**:
- `src/pages/CartPage.tsx` - 업셀링 섹션 추가
- `src/utils/upsellRecommendations.ts` - 추천 로직 유틸리티 (신규 생성)
- `src/components/cart/UpsellCard.tsx` - 추천 상품 카드 컴포넌트 (신규 생성)

---

### 🛠️ FR-V3-003: 스마트 관리자 제어

**사용자 스토리**:
1. 관리자는 메뉴를 삭제하지 않고 "오늘만 품절(Sold Out)" 처리를 할 수 있습니다.
2. 주방이 너무 바쁠 때 전역으로 "주문 일시 정지" 스위치를 켤 수 있습니다.

**DB 스키마 변경**:
- `menus/{menuId}`: `isSoldOut` (boolean), `isHidden` (boolean) 추가
- `stores/{storeId}`: `isOrderingPaused` (boolean), `pausedReason` (string) 추가

**파일 위치**:
- `src/types/menu.ts` - Menu 타입 정의 수정
- `src/types/store.ts` - Store 타입 정의 수정
- `src/pages/admin/AdminMenuManagement.tsx` - 품절/숨김 토글 추가
- `src/pages/admin/AdminStoreSettings.tsx` 또는 AdminHeader - 주문 일시정지 토글 추가
- `src/pages/CheckoutPage.tsx` - 주문 차단 로직 추가
- `src/services/menuService.ts` - 메뉴 상태 업데이트 함수 추가

---

### 📊 FR-V3-004: 고급 일간 리포트

**사용자 스토리**: 관리자 대시보드에서 "오늘의 매장 현황"을 봅니다 (매출, 주문 수, 객단가, 인기 메뉴 TOP 5).

**로직**:
1. 오늘(today) 주문 데이터를 클라이언트 측에서 집계 (MVP 최적화)
2. 계산식: 총 매출 / 총 주문 수 = 객단가(AOV)
3. 시각화: 심플한 카드 그리드 + TOP 5 바 차트

**파일 위치**:
- `src/pages/admin/AdminStatsPage.tsx` - 대시보드 UI 업데이트
- `src/hooks/useDailyStats.ts` - 일간 통계 훅 (신규 생성)
- `src/components/admin/DashboardWidget.tsx` - 통계 위젯 컴포넌트 (신규 생성)

---

### 🧠 FR-V3-005: 간편 추천 엔진

**사용자 스토리**: 메뉴 상세 화면 하단에 "이 메뉴와 함께 많이 주문한 메뉴" 섹션이 표시됩니다.

**로직**:
1. 해당 메뉴가 포함된 최근 50개 주문을 조회합니다.
2. 가장 빈번하게 같이 주문된 항목을 추출합니다.
3. 상위 3개를 표시합니다.

**파일 위치**:
- `src/components/menu/MenuDetail.tsx` 또는 메뉴 상세 컴포넌트 - 추천 섹션 추가
- `src/utils/menuAssociations.ts` - 메뉴 연관성 분석 유틸리티 (신규 생성)

---

## 3. 🛣️ 초원자 단위 개발 로드맵 (Atomic Roadmap)

### ✅ Step 0: 환경 설정 (즉시 실행)

**상태**: ✅ 완료

- [x] A0-1: `fir-delivery-appv3-b3c31` 프로젝트용 `.env.local` 자격 증명 확인
- [x] A0-2: `.firebaserc` 타겟 업데이트
- [x] A0-3: 로컬 서버 실행 및 연결 확인

---

### 🛠️ Step 1: 스마트 관리 컨트롤 (기반 작업)

**이유**: 다른 기능에 영향을 미치는 스키마 변경이 필요하므로 가장 먼저 수행합니다.

#### 작업 목록

- [ ] **A1-1**: Menu 타입 정의(`src/types/menu.ts`)에 `isSoldOut`, `isHidden` 추가
  - 기존 `soldout` 필드와의 호환성 고려
  - 기본값: `isSoldOut: false`, `isHidden: false`

- [ ] **A1-2**: Store 타입 정의(`src/types/store.ts`)에 `isOrderingPaused`, `pausedReason` 추가
  - `settings` 객체 내부 또는 최상위 레벨에 추가
  - 기본값: `isOrderingPaused: false`, `pausedReason: ''`

- [ ] **A1-3**: `AdminMenuManagement.tsx` 수정 - 품절/숨김 토글 스위치 추가
  - 메뉴 목록에 토글 스위치 UI 추가
  - 실시간 상태 변경 반영

- [ ] **A1-4**: `updateMenuStatus` 서비스 함수 구현 (`src/services/menuService.ts`)
  - `isSoldOut`, `isHidden` 상태 업데이트 함수
  - Firestore 업데이트 로직

- [ ] **A1-5**: AdminHeader 또는 AdminSidebar 수정 - "매장 상태" 토글(영업중/일시정지) 추가
  - 전역 주문 일시정지 스위치 UI
  - 상태 변경 시 Store 문서 업데이트

- [ ] **A1-6**: `CheckoutPage.tsx` 내 미들웨어/체크 로직 구현
  - `store.isOrderingPaused` 상태면 주문 차단
  - 사용자에게 안내 메시지 표시
  - 장바구니 페이지에서도 사전 경고 (선택사항)

#### 완료 기준
- [ ] 모든 타입 정의 업데이트 완료
- [ ] 관리자 UI에서 품절/일시정지 설정 가능
- [ ] 주문 시 일시정지 상태 체크 정상 작동
- [ ] 품절 메뉴는 메뉴 페이지에서 제외 또는 표시

---

### 🔄 Step 2: 원클릭 재주문 (재방문율)

#### 작업 목록

- [ ] **A2-1**: `useReorder` 훅 생성 (`src/hooks/useReorder.ts`)
  - 주문 데이터 조회 및 검증 로직
  - 메뉴 유효성 검사 (존재 여부, `isSoldOut` 체크)
  - 장바구니에 추가하는 로직

- [ ] **A2-2**: `OrderDetailPage.tsx` 업데이트 - "재주문" 버튼 추가
  - 주문 상세 페이지에 재주문 버튼 UI 추가
  - 로딩 상태 처리
  - 성공/실패 토스트 메시지

- [ ] **A2-3**: 플로우 검증
  - 클릭 → 장바구니 업데이트 → 주문서 이동
  - 일부 메뉴 품절 시 경고 및 가능한 메뉴만 추가
  - 전체 품절 시 적절한 안내 메시지

#### 완료 기준
- [ ] 재주문 버튼 클릭 시 이전 주문이 장바구니에 정상 추가
- [ ] 품절 메뉴 처리 정상 작동
- [ ] 장바구니 페이지로 자동 이동 또는 확인 모달 표시

---

### 🛒 Step 3: 장바구니 업셀링 (매출)

#### 작업 목록

- [ ] **A3-1**: `getUpsellRecommendations(cartItems, allMenus)` 유틸리티 구현
  - 파일: `src/utils/upsellRecommendations.ts`
  - 카테고리 분석 로직
  - 추천 메뉴 필터링 (품절 제외, 장바구니에 없는 항목만)

- [ ] **A3-2**: `UpsellCard` 컴포넌트 생성 (`src/components/cart/UpsellCard.tsx`)
  - 추천 상품용 소형 UI 카드
  - 이미지, 이름, 가격, "추가" 버튼

- [ ] **A3-3**: `CartPage.tsx` 업데이트 - 하단에 업셀링 섹션 주입
  - "이런 메뉴는 어떠세요?" 섹션 추가
  - 가로 스크롤 또는 그리드 레이아웃
  - 추천 항목이 없을 때 숨김 처리

#### 완료 기준
- [ ] 장바구니에 상품이 있을 때 추천 메뉴 표시
- [ ] 추천 메뉴 클릭 시 장바구니에 추가 가능
- [ ] 카테고리 기반 추천 로직 정상 작동

---

### 📊 Step 4: 고급 일간 리포트 (통찰력)

#### 작업 목록

- [ ] **A4-1**: `useDailyStats` 훅 생성 (`src/hooks/useDailyStats.ts`)
  - 오늘 주문 필터링
  - 매출, 주문 수, 객단가 계산
  - 인기 메뉴 TOP 5 추출

- [ ] **A4-2**: `DashboardWidget` 컴포넌트 구현 (`src/components/admin/DashboardWidget.tsx`)
  - 재사용 가능한 통계 카드 컴포넌트
  - 아이콘, 제목, 값, 증감율 표시 (선택사항)

- [ ] **A4-3**: `AdminStatsPage.tsx` 업데이트 - 새로운 대시보드 그리드 배치
  - 매출 카드
  - 주문 수 카드
  - 객단가(AOV) 카드
  - 인기 메뉴 TOP 5 바 차트 (Recharts 사용)

#### 완료 기준
- [ ] 오늘 날짜 기준 통계 정확히 계산
- [ ] 모든 통계 카드 정상 표시
- [ ] 인기 메뉴 차트 정상 렌더링
- [ ] 데이터가 없을 때 빈 상태 처리

---

### 🧠 Step 5: 간편 추천 엔진 (지능화)

#### 작업 목록

- [ ] **A5-1**: `getMenuAssociations` 유틸리티 구현 (`src/utils/menuAssociations.ts`)
  - 최근 주문 클라이언트 측 분석
  - 특정 메뉴와 함께 주문된 메뉴 빈도 계산
  - 상위 3개 반환

- [ ] **A5-2**: 메뉴 상세 컴포넌트 업데이트 - "함께 많이 주문한 메뉴" 섹션 추가
  - `MenuPage.tsx` 또는 메뉴 상세 모달 컴포넌트 확인 필요
  - 하단에 추천 섹션 추가
  - 추천 메뉴 클릭 시 해당 메뉴 상세로 이동

#### 완료 기준
- [ ] 메뉴 상세 화면에 추천 메뉴 섹션 표시
- [ ] 추천 로직 정확히 작동 (최근 50개 주문 기준)
- [ ] 추천 항목이 없을 때 섹션 숨김 처리
- [ ] 추천 메뉴 클릭 시 정상 동작

---

## 4. 실행 전략

### 개발 순서

우리는 **Step 0 → Step 1 → Step 2 → Step 3 → Step 4 → Step 5** 순서를 엄격히 준수합니다.

각 단계는 다음 단계로 넘어가기 전에 **초원자 단위(Atomic Unit)**로 완벽하게 검증됩니다.

### 작업 규칙

1. **원자적 작업**: 각 작업(A1-1, A1-2 등)은 독립적으로 완료 가능해야 합니다.
2. **검증 필수**: 각 작업 완료 후 즉시 테스트 및 검증
3. **커밋 단위**: 각 원자적 작업 단위로 커밋
4. **타입 안정성**: TypeScript 타입 정의 우선 수정

### 검증 체크리스트

각 Step 완료 시 다음을 확인:
- [ ] 기능 작동 확인
- [ ] 타입 에러 없음
- [ ] 린트 에러 없음
- [ ] UI/UX 일관성 유지
- [ ] 에러 처리 구현
- [ ] 로딩 상태 처리

---

## 5. 예상 시간표

| Step | 작업 | 예상 시간 |
|------|------|----------|
| Step 0 | 환경 설정 | ✅ 완료 |
| Step 1 | 스마트 관리 컨트롤 | 6-8시간 |
| Step 2 | 원클릭 재주문 | 4-5시간 |
| Step 3 | 장바구니 업셀링 | 4-5시간 |
| Step 4 | 고급 일간 리포트 | 6-8시간 |
| Step 5 | 간편 추천 엔진 | 4-5시간 |
| **총계** | | **24-31시간** |

---

## 6. 성공 지표

### 비즈니스 지표
- **재방문율**: 재주문 기능 사용률 20% 이상
- **객단가(AOV)**: 업셀링 추천 클릭률 10% 이상, AOV 5% 상승
- **운영 효율성**: 관리자 품절/일시정지 기능 사용률 80% 이상

### 기술 지표
- 모든 기능 정상 작동
- 타입 안정성 100%
- 성능 저하 없음 (로딩 시간 3초 이내 유지)

---

## 7. 리스크 및 대응 방안

### 리스크
1. **Firestore 쿼리 성능**: 최근 50개 주문 조회 시 성능 이슈 가능
   - 대응: 인덱스 추가, 페이지네이션 고려

2. **타입 호환성**: 기존 `soldout` 필드와 `isSoldOut` 필드 충돌
   - 대응: 마이그레이션 로직 추가 또는 기존 필드 활용

3. **데이터 일관성**: 클라이언트 측 통계 계산의 정확성
   - 대응: 서버 측 집계 고려 (향후 개선)

---

**작성일**: 2024년 12월  
**프로젝트**: S-Delivery-AppV3  
**버전**: V3.0.0  
**상태**: 개발 준비 완료

