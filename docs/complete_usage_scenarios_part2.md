# My-Pho-App 완전 사용 시나리오 - Part 2: 주문 프로세스

## 📱 고객 앱 시나리오 (계속)

---

### 시나리오 2: 장바구니 및 주문하기

#### 2-1. 장바구니 담기

**이전 상태**: MenuDetail 페이지에서 옵션 선택 완료
- 메뉴: 소고기 마라탕
- 옵션: 보통맛, 1인분, 새우 추가
- 수량: 2개
- 총액: ₩28,000

**사용자 액션**: [장바구니 담기] 버튼 터치

**UI 반응 (애니메이션 시퀀스)**:
1. 버튼 눌림 효과 (scale: 1.0 → 0.95 → 1.0, 0.2초)
2. 장바구니 아이콘에 상품 날아가는 애니메이션
   ```
   메뉴 이미지 미니어처가 화면 중앙에서
   우측 상단 장바구니 아이콘으로 포물선을 그리며 이동
   (1초 동안)
   ```
3. 장바구니 아이콘 튕기는 효과 (bounce)
4. 장바구니 배지 업데이트: `없음` → `2` (빨간 원형 배지)
5. 성공 토스트 메시지 (화면 하단):
   ```
   ┌─────────────────────────────────┐
   │ ✅ 장바구니에 담겼습니다          │
   │ [장바구니 보기]                  │ 버튼 포함
   └─────────────────────────────────┘
   ```
6. 모달 자동으로 닫힘 (0.5초 후)
7. MenuList 페이지로 복귀

**Firestore 업데이트**:
```javascript
users/{userId}/cart/{itemId}: {
  menuId: "menu123",
  menuName: "소고기 마라탕",
  price: 12000,
  options: {
    spicyLevel: "보통맛",
    size: "1인분",
    toppings: ["새우 추가"]
  },
  optionPrice: 2000,
  quantity: 2,
  totalPrice: 28000,
  addedAt: Timestamp
}
```

**사용자 액션**: 토스트의 [장바구니 보기] 버튼 터치

**화면 전환**: Cart 페이지로 이동

---

#### 2-2. 장바구니 페이지

**Cart 화면 구성**:
```
┌─────────────────────────────────┐
│ ← 뒤로        장바구니            │
├─────────────────────────────────┤
│                                 │
│ 📍 배달 주소                     │
│ 서울시 강남구 테헤란로 123       │
│ 101동 1001호           [변경 >]  │
│                                 │
├─────────────────────────────────┤
│ 주문 상품 (2개)                  │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ ☑                           │ │ 체크박스
│ │ ┌───┐                       │ │
│ │ │썸네│ 소고기 마라탕          │ │
│ │ │일 │                       │ │
│ │ └───┘ 보통맛 / 1인분         │ │
│ │      + 새우 추가             │ │
│ │                             │ │
│ │      ₩14,000                │ │ 개당 가격
│ │      [-]  2  [+]    [🗑 삭제] │ │ 수량조절
│ │                             │ │
│ │      소계: ₩28,000          │ │
│ └─────────────────────────────┘ │
│                                 │
├─────────────────────────────────┤
│ 🎫 쿠폰 / 할인                   │
│ [쿠폰 선택하기 >]                │
│                                 │
├─────────────────────────────────┤
│ 💰 결제 금액                     │
│                                 │
│ 주문 금액             ₩28,000   │
│ 배달팁                ₩3,000    │
│ 쿠폰 할인               -₩0     │
│ ─────────────────────────────   │
│ 총 결제 금액         ₩31,000    │ 굵게, 큼
│                                 │
├─────────────────────────────────┤
│ [   ₩31,000 주문하기   ]        │ 하단 고정 버튼
└─────────────────────────────────┘
```

**인터랙션 1**: 수량 [-] 버튼 터치

**UI 반응**:
- 수량: `2` → `1`
- 소계: `₩28,000` → `₩14,000` (빨간색 깜빡임)
- 총 결제 금액: `₩31,000` → `₩17,000`
- 가격 변경 애니메이션 (숫자 카운트 효과)

**인터랙션 2**: [쿠폰 선택하기] 터치

**쿠폰 선택 모달 표시**:
```
┌─────────────────────────────────┐
│ 쿠폰 선택              [X 닫기]  │
├─────────────────────────────────┤
│ 사용 가능한 쿠폰 (2장)            │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ ○  첫 주문 3,000원 할인      │ │
│ │                             │ │
│ │    최소 주문금액 15,000원    │ │
│ │    ~ 2025.12.31             │ │
│ └─────────────────────────────┘ │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ ○  10% 할인 (최대 5,000원)   │ │
│ │                             │ │
│ │    최소 주문금액 20,000원  ❌│ │ 사용불가 표시
│ │    조건 미충족              │ │
│ └─────────────────────────────┘ │
│                                 │
│ [       적용하기       ]        │
└─────────────────────────────────┘
```

**사용자 액션**: 첫 번째 쿠폰 선택 (라디오 버튼 터치)

**UI 반응**:
- 라디오 버튼 선택: `○` → `●`
- 쿠폰 카드 배경색 변경 (흰색 → 연한 파란색)
- 쿠폰 카드에 체크 아이콘 표시 (우측 상단)

**사용자 액션**: [적용하기] 버튼 터치

**UI 반응**:
1. 모달 닫힘
2. 장바구니 페이지 업데이트:
   ```
   쿠폰 할인           -₩3,000  (빨간색)
   ─────────────────────────────
   총 결제 금액         ₩14,000  (가격 애니메이션)
   ```
3. 적용된 쿠폰 표시:
   ```
   🎫 쿠폰 / 할인
   ✅ 첫 주문 3,000원 할인     [변경]
   ```

---

#### 2-3. 주문하기 (Checkout)

**사용자 액션**: [₩14,000 주문하기] 버튼 터치

**화면 전환**: Checkout 페이지

**Checkout 화면**:
```
┌─────────────────────────────────┐
│ ← 뒤로        주문/결제           │
├─────────────────────────────────┤
│                                 │
│ 📍 배달 정보                     │
│ ┌─────────────────────────────┐ │
│ │ 서울시 강남구 테헤란로 123    │ │
│ │ 101동 1001호                 │ │
│ │                      [변경]  │ │
│ └─────────────────────────────┘ │
│                                 │
│ 📝 배달 요청사항                 │
│ ┌─────────────────────────────┐ │
│ │ 초인종 눌러주세요            │ │
│ └─────────────────────────────┘ │
│                                 │
│ 🍴 식기 수량                     │
│ [-]  2  [+]                     │
│                                 │
├─────────────────────────────────┤
│ 📞 주문자 정보                   │
│ ┌─────────────────────────────┐ │
│ │ 이름: 김철수                 │ │
│ │ 전화번호: 010-1234-5678      │ │
│ │                      [변경]  │ │
│ └─────────────────────────────┘ │
│                                 │
├─────────────────────────────────┤
│ 💳 결제 수단                     │
│ ● 카드 결제 (NICEPAY)           │
│ ○ 만나서 결제                    │
│   (현금 / 카드)                 │
│                                 │
├─────────────────────────────────┤
│ 📋 주문 상품                     │
│ ┌─────────────────────────────┐ │
│ │ 소고기 마라탕 x 1            │ │
│ │ (보통맛, 새우추가)           │ │
│ │                   ₩14,000   │ │
│ └─────────────────────────────┘ │
│                                 │
│ 주문 금액             ₩14,000   │
│ 배달팁                ₩3,000    │
│ 쿠폰 할인            -₩3,000    │
│ ─────────────────────────────── │
│ 총 결제 금액         ₩14,000    │
│                                 │
├─────────────────────────────────┤
│ ☑ 주문 내용을 확인했으며,        │
│   개인정보 제공에 동의합니다      │
│                                 │
│ [   ₩14,000 결제하기   ]        │ 하단 버튼
└─────────────────────────────────┘
```

**사용자 액션**: [₩14,000 결제하기] 버튼 터치

**시스템 처리 시퀀스**:

1. **주문 생성 (Firestore)**:
   ```javascript
   orders/{orderId}: {
     userId: "user123",
     orderNumber: "20251206001",
     status: "pending", // 결제 대기
     items: [{
       menuId: "menu123",
       menuName: "소고기 마라탕",
       options: {...},
       quantity: 1,
       price: 14000
     }],
     deliveryAddress: {
       roadAddress: "서울시 강남구 테헤란로 123",
       detailAddress: "101동 1001호",
       request: "초인종 눌러주세요"
     },
     customerInfo: {
       name: "김철수",
       phone: "010-1234-5678"
     },
     payment: {
       method: "card",
       amount: 14000,
       deliveryFee: 3000,
       couponDiscount: 3000,
       totalAmount: 14000
     },
     createdAt: Timestamp,
     estimatedTime: 40 // 분
   }
   ```

2. **결제 프로세스 시작**:
   - 로딩 오버레이 표시:
     ```
     ┌─────────────────────────────────┐
     │                                 │
     │        ⏳ 결제 진행 중...         │
     │                                 │
     │    잠시만 기다려주세요            │
     │                                 │
     └─────────────────────────────────┘
     ```

3. **NICEPAY 결제창 호출**:
   - 새 창 또는 모달로 NICEPAY 결제 페이지 표시
   ```
   ┌─────────────────────────────────┐
   │ NICEPAY 결제                     │
   ├─────────────────────────────────┤
   │ 결제 금액: 14,000원              │
   │                                 │
   │ 카드 정보 입력                   │
   │ ┌─────────────────────────────┐ │
   │ │ 카드번호                     │ │
   │ │ 1234-5678-9012-3456         │ │
   │ └─────────────────────────────┘ │
   │ ┌──────┐ ┌──────┐             │
   │ │ MM/YY│ │ CVC  │             │
   │ │ 12/25│ │ 123  │             │
   │ └──────┘ └──────┘             │
   │                                 │
   │ 비밀번호 앞 2자리                │
   │ ┌─────┐                        │
   │ │ ** │●                        │
   │ └─────┘                        │
   │                                 │
   │ [       결제하기       ]        │
   └─────────────────────────────────┘
   ```

4. **결제 승인 처리**:
   - NICEPAY 서버 통신
   - Cloud Function 호출 (approvePayment)
   - 결제 승인 응답 대기

5. **결제 성공 시**:
   - Firestore 업데이트:
     ```javascript
     orders/{orderId}: {
       status: "confirmed", // 접수됨
       payment: {
         ...existing,
         paymentId: "pay_abc123",
         approvedAt: Timestamp,
         status: "approved"
       }
     }
     ```
   - 장바구니 비우기
   - PaymentResult 페이지로 리다이렉트

---

#### 2-4. 결제 완료 (PaymentResult)

**PaymentResult 화면**:
```
┌─────────────────────────────────┐
│                                 │
│         ✅                       │ 큰 체크 아이콘
│                                 │
│      주문이 완료되었습니다!       │ 제목 (굵게, 24px)
│                                 │
│   음식을 정성껏 준비하겠습니다    │ 부제목
│                                 │
├─────────────────────────────────┤
│                                 │
│ 주문번호: 20251206001            │
│ 예상 도착 시간: 약 40분           │
│                                 │
├─────────────────────────────────┤
│ 📋 주문 내역                     │
│                                 │
│ 소고기 마라탕 x 1     ₩14,000   │
│ 배달팁                ₩3,000    │
│ 쿠폰 할인            -₩3,000    │
│ ─────────────────────────────── │
│ 결제 금액            ₩14,000    │
│                                 │
│ 결제 수단: 신용카드(****3456)    │
│                                 │
├─────────────────────────────────┤
│ 📍 배달 주소                     │
│ 서울시 강남구 테헤란로 123       │
│ 101동 1001호                    │
│                                 │
├─────────────────────────────────┤
│ [    주문 상세 보기    ]         │ 버튼
│ [       홈으로       ]          │ 버튼
└─────────────────────────────────┘
```

**자동 알림 발송**:
1. **푸시 알림**:
   ```
   🍜 주문이 접수되었습니다!
   대박마라탕에서 음식을 준비 중입니다.
   예상 시간: 약 40분
   ```

2. **SMS 알림** (선택):
   ```
   [대박마라탕] 주문이 완료되었습니다.
   주문번호: 20251206001
   예상 도착: 약 40분 후
   ```

**사용자 액션**: [주문 상세 보기] 버튼 터치

**화면 전환**: OrderTracking 페이지

---

#### 2-5. 주문 추적 (OrderTracking)

**OrderTracking 화면**:
```
┌─────────────────────────────────┐
│ ← 뒤로      주문 #20251206001    │
├─────────────────────────────────┤
│                                 │
│ 🕐 예상 도착 시간                 │
│                                 │
│     오후 2:40                    │ 큰 시간 표시
│     (약 35분 남음)               │
│                                 │
├─────────────────────────────────┤
│ 📍 진행 상황                     │
│                                 │
│ ●━━━━━━━━━━○━━━━━━━━○          │ 프로그레스 바
│ 접수   조리중   배달중   완료     │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ ✅ 주문 접수                 │ │
│ │    오후 2:05                │ │
│ │                             │ │
│ │ 🍳 조리 중                   │ │ 현재 단계 (강조)
│ │    오후 2:10 시작           │ │
│ │    맛있게 준비하고 있어요!   │ │
│ │                             │ │
│ │ 🚚 배달 준비 중              │ │
│ │    곧 출발합니다             │ │
│ │                             │ │
│ │ ✓ 배달 완료                  │ │
│ │                             │ │
│ └─────────────────────────────┘ │
│                                 │
├─────────────────────────────────┤
│ 📋 주문 정보                     │
│                                 │
│ 메뉴                            │
│ • 소고기 마라탕 x 1             │
│   (보통맛, 새우추가)             │
│                                 │
│ 배달 주소                        │
│ 서울시 강남구 테헤란로 123       │
│ 101동 1001호                    │
│                                 │
│ 요청사항                         │
│ 초인종 눌러주세요                 │
│                                 │
│ 결제 금액                        │
│ ₩14,000 (카드 결제 완료)        │
│                                 │
├─────────────────────────────────┤
│ [🏪 가게에 전화하기]              │ 버튼
│ [📞 고객센터 문의]                │ 버튼
│                                 │
│ [   주문 취소 요청   ]          │ 취소 버튼 (빨간색)
└─────────────────────────────────┘
```

**실시간 업데이트**:
- Firestore 실시간 리스너로 주문 상태 감지
- 상태 변경 시 자동으로 UI 업데이트 + 푸시 알림

**상태 변경 시나리오**:

**관리자가 "배달 시작" 처리 시**:
1. Firestore 업데이트:
   ```javascript
   orders/{orderId}: {
     status: "delivering",
     deliveryStartedAt: Timestamp
   }
   ```

2. **UI 자동 업데이트**:
   - 프로그레스 바 진행:
     ```
     ●━━━━━━━━━━●━━━━━━━━○
     접수   조리중   배달중   완료
     ```
   - "🚚 배달 중" 섹션 강조 (파란 배경)
   - 시간 업데이트: "약 35분 남음" → "약 10분 남음"

3. **푸시 알림 발송**:
   ```
   🚚 배달이 시작되었습니다!
   곧 도착할 예정입니다.
   ```

**배달 완료 시**:
1. 상태: `delivering` → `delivered`
2. **UI 업데이트**:
   ```
   ●━━━━━━━━━━●━━━━━━━━●
   ```
3. **완료 모달 표시**:
   ```
   ┌─────────────────────────────────┐
   │                                 │
   │         🎉                      │
   │                                 │
   │      배달이 완료되었습니다!       │
   │                                 │
   │   맛있게 드세요!                 │
   │                                 │
   │ [      리뷰 작성하기    ]       │ 버튼
   │ [       확인       ]            │
   └─────────────────────────────────┘
   ```

---

#### 2-6. 리뷰 작성 (ReviewWrite)

**사용자 액션**: [리뷰 작성하기] 버튼 터치

**ReviewWrite 화면**:
```
┌─────────────────────────────────┐
│ ← 뒤로        리뷰 작성           │
├─────────────────────────────────┤
│                                 │
│ 어떠셨나요?                      │ 제목
│                                 │
│ ┌─────────────────────────────┐ │
│ │ ┌───┐                       │ │
│ │ │ 썸│ 소고기 마라탕          │ │
│ │ │네일│                       │ │
│ │ └───┘                       │ │
│ └─────────────────────────────┘ │
│                                 │
│ ⭐ 별점을 선택하세요              │
│                                 │
│   ☆ ☆ ☆ ☆ ☆                   │ 별 5개 (비활성)
│                                 │
│ 리뷰 작성 (선택)                 │
│ ┌─────────────────────────────┐ │
│ │                            │ │
│ │ 맛, 양, 배달 등에 대해      │ │ 플레이스홀더
│ │ 자유롭게 적어주세요         │ │
│ │                            │ │ 멀티라인 (최대 500자)
│ │                            │ │
│ └─────────────────────────────┘ │
│ 0 / 500                         │ 글자 수
│                                 │
│ 📷 사진 첨부 (선택, 최대 3장)     │
│ ┌────┐ ┌────┐ ┌────┐          │
│ │ + │ │    │ │    │          │ 사진 업로드 박스
│ └────┘ └────┘ └────┘          │
│                                 │
│ [     리뷰 등록하기    ]         │ 버튼 (비활성)
└─────────────────────────────────┘
```

**인터랙션 1**: 세 번째 별 터치

**UI 반응**:
- 터치한 별까지 채워짐 (애니메이션):
  ```
  ★ ★ ★ ☆ ☆  (0.3초 동안 순차적으로)
  ```
- 각 별이 반짝이는 효과
- 별 아래에 텍스트 표시:
  ```
  보통이에요
  ```
  (1-5점에 따라: 별로예요 / 그저그래요 / 보통이에요 / 좋아요 / 최고예요!)

**인터랙션 2**: 리뷰 텍스트 입력

**사용자 입력**:
```
맛있게 잘 먹었습니다!
양도 푸짐하고 빠르게 배달되어서 좋았어요.
```

**실시간 반응**:
- 글자 수 카운터 실시간 업데이트: `0 / 500` → `47 / 500`
- [리뷰 등록하기] 버튼 활성화 (별점만 있어도 활성화됨)

**인터랙션 3**: 사진 첨부

**사용자 액션**: [+] 박스 터치

**시스템 반응**:
- 사진 선택 모달 표시:
  ```
  ┌─────────────────────────────────┐
  │ 사진 선택                        │
  ├─────────────────────────────────┤
  │ [📷 카메라로 촬영]                │
  │ [🖼 갤러리에서 선택]               │
  │ [취소]                          │
  └─────────────────────────────────┘
  ```

**사용자 선택**: [🖼 갤러리에서 선택]

- 기기 사진 갤러리 열림
- 사진 선택 (최대 3장)
- 선택 완료 시 업로드 진행:
  ```
  ┌────┐
  │⏳ │ 업로드 중... (프로그레스 바)
  └────┘
  ```
- 업로드 완료 시:
  ```
  ┌────┐
  │📷 │ 썸네일 표시 + [X] 삭제 버튼
  └────┘
  ```

**사용자 액션**: [리뷰 등록하기] 버튼 터치

**시스템 처리**:
1. 로딩 상태:
   ```
   [  ⏳ 등록 중...  ]
   ```

2. Firestore 저장:
   ```javascript
   reviews/{reviewId}: {
     orderId: "order123",
     userId: "user123",
     menuId: "menu123",
     rating: 3,
     comment: "맛있게 잘 먹었습니다!...",
     photos: ["url1", "url2"],
     createdAt: Timestamp
   }
   
   // 주문에도 리뷰 정보 추가
   orders/{orderId}: {
     reviewId: "review123",
     reviewed: true
   }
   
   // 메뉴 평점 업데이트
   menus/{menuId}: {
     rating: 4.8 (재계산),
     reviewCount: increment(1)
   }
   ```

3. 성공 시:
   - 성공 토스트: `✅ 리뷰가 등록되었습니다`
   - 포인트 적립 알림:
     ```
     ┌─────────────────────────────────┐
     │ 🎁 리뷰 작성 감사합니다!          │
     │    포인트 500P가 적립되었습니다   │
     └─────────────────────────────────┘
     ```
   - OrderHistory 페이지로 이동

---

### 시나리오 3: 주문 내역 및 재주문

#### 3-1. 주문 내역 페이지 (OrderHistory)

**사용자 액션**: 하단 네비게이션 [주문내역] 탭 터치

**OrderHistory 화면**:
```
┌─────────────────────────────────┐
│          주문 내역               │
├─────────────────────────────────┤
│ [전체] [배달중] [완료] [취소]    │ 필터 탭
├─────────────────────────────────┤
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 2025.12.06  14:05           │ │ 날짜/시간
│ │ 주문번호: 20251206001       │ │
│ │                             │ │
│ │ [✅ 배달 완료]  [리뷰 작성함]│ │ 상태 배지
│ │                             │ │
│ │ • 소고기 마라탕 x 1         │ │ 주문 항목
│ │                             │ │
│ │ ₩14,000                     │ │ 금액
│ │                             │ │
│ │ [상세보기] [재주문하기]      │ │ 액션 버튼
│ └─────────────────────────────┘ │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 2025.11.20  18:30           │ │
│ │ 주문번호: 20251120005       │ │
│ │                             │ │
│ │ [✅ 배달 완료]  [리뷰 없음] │ │
│ │                             │ │
│ │ • 해물 마라탕 x 2           │ │
│ │ • 꿔바로우 x 1              │ │
│ │                             │ │
│ │ ₩32,000                     │ │
│ │                             │ │
│ │ [상세보기] [재주문하기]      │ │
│ └─────────────────────────────┘ │
│                                 │
│ [더 보기...]                    │ 무한 스크롤
└─────────────────────────────────┘
```

**인터랙션**: [재주문하기] 버튼 터치

**UI 반응**:
1. 확인 대화상자:
   ```
   ┌─────────────────────────────────┐
   │ 재주문 확인                      │
   ├─────────────────────────────────┤
   │ 이전 주문과 동일한 메뉴를         │
   │ 장바구니에 담으시겠습니까?        │
   │                                 │
   │ • 소고기 마라탕 x 1             │
   │   (보통맛, 새우추가)             │
   │                                 │
   │ [취소]          [담기]          │
   └─────────────────────────────────┘
   ```

2. [담기] 선택 시:
   - 장바구니에 추가
   - 성공 토스트: `✅ 장바구니에 담겼습니다`
   - Cart 페이지로 자동 이동 옵션 제공

---

계속해서 관리자 대시보드 시나리오를 작성하겠습니다...
